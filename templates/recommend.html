{% extends 'base.html' %}
{% block title %}Recommend Book{% endblock %}

{% block content %}

<header>
  <h1 style="text-align: center; margin-top: 3em; margin-bottom: 1.5em;">Discover the Book You Want to Read Next</h1>
</header>

<div style="max-width: 1200px; margin: 0 auto; padding: 0 1em;">

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages" style="margin: 1em auto; max-width: 800px;">
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}" style="
              padding: 1em;
              margin-bottom: 1em;
              border-radius: 8px;
              background: {% if category == 'error' %}#ffebee{% elif category == 'info' %}#e3f2fd{% else %}#f5f5f5{% endif %};
              color: {% if category == 'error' %}#b71c1c{% elif category == 'info' %}#0d47a1{% else %}#333{% endif %};
              border-left: 4px solid {% if category == 'error' %}#d32f2f{% elif category == 'info' %}#1976d2{% else %}#9e9e9e{% endif %};
          ">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}


  {% if books is not none %}
    {% if books %}
      <div class="booksection" style="padding: 2em 0;">
        <h2 style="margin-left: 1em; margin-bottom: 1em;">
          {% if books|length == 1 %}Book Found{% else %}Searched Book{% endif %}
        </h2>
        <div class="bookgrid" style="
            display: flex;
            flex-wrap: wrap;
            gap: 2em;
            justify-content: center;
            padding: 0 1em;
        ">
          {% set searched_book = books[0] %}
          <a class="book-link" href="{{ url_for('show_book', isbn=searched_book.ISBN) }}" style="text-decoration: none; color: inherit;">
            <div class="book" style="
                width: 200px;
                background: white;
                border-radius: 12px;
                padding: 15px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
                text-align: center;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
                border: none;
            ">
              <img src="{{ searched_book['Image-URL-M'] or '/static/default_cover.png' }}" 
                   alt="{{ searched_book['Book-Title'] }}" 
                   style="width: 100%; height: 250px; object-fit: cover; border-radius: 8px;">
              <h3 style="margin-top: 0.8em; font-weight: bold; font-size: 1rem; margin-bottom: 0.3em;">{{ searched_book['Book-Title'] }}</h3>
              <p style="font-size: 0.8rem; color: #555; margin: 0;">{{ searched_book['Book-Author'] }}</p>
            </div>
          </a>
        </div>
      </div>

      <!-- Recommended Books Row -->
      {% if books|length > 1 %}
      <div class="booksection" style="padding: 2em 0; margin-top: 1em;">
        <h2 style="margin-left: 1em; margin-bottom: 1em;">Recommended Books</h2>
        <div class="bookgrid" style="
          display: flex;
          flex-wrap: wrap;
          gap: 2em;
          justify-content: center;
          margin: 0 auto;
          max-width: 1000px;
        ">

          {% for book in books[1:] %}
          <a class="book-link" href="{{ url_for('show_book', isbn=book.ISBN) }}" style="text-decoration: none; color: inherit;">
            <div class="book" style="
                width: 150px;
                background: white;
                border-radius: 12px;
                padding: 10px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
                text-align: center;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
                border: none;
            ">
              <img src="{{ book['Image-URL-M'] or '/static/default_cover.png' }}" 
                   alt="{{ book['Book-Title'] }}" 
                   style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
              <h4 style="margin-top: 0.5em; font-weight: bold; font-size: 0.9rem; margin-bottom: 0.2em;">{{ book['Book-Title'] }}</h4>
              <p style="font-size: 0.8rem; color: #555; margin: 0;">{{ book['Book-Author'] }}</p>
            </div>
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    {% else %}
      <div class="no-results" style="text-align: center; margin: 3em 0;">
        <img src="/static/no-results.png" alt="No results found" style="width: 150px; opacity: 0.7; margin-bottom: 1em;">
        <p style="font-size: 1.2em; color: #555;">No books found matching your search.</p>
        <p style="color: #777;">Try a different book title.</p>
      </div>
    {% endif %}
  {% else %}
    <div class="initial-state" style="text-align: center; margin: 3em 0;">
      <img src="/static/search-icon.png" alt="Search for books" style="width: 150px; opacity: 0.7; margin-bottom: 1em;">
      <p style="font-size: 1.2em; color: #555;">Search for books to get recommendations</p>
      <p style="color: #777;">Enter a book title you enjoy to find similar books</p>
    </div>
  {% endif %}
</div>

<style>
  .book:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
  }
  .book-link:hover {
    text-decoration: none;
  }
</style>

{% endblock %}
